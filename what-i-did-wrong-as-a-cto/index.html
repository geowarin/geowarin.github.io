<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>What I Did Wrong as a CTO | Geowarin</title>
<meta name=keywords content="kotlin,react,architecture,rest">
<meta name=description content="I spent one year as a CTO for a startup. Here are some technical decisions I came to regret and those that I would make again in my next project">
<meta name=author content>
<link rel=canonical href=https://geowarin.github.io/what-i-did-wrong-as-a-cto/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.6f60056d44d3f7eb69a4bc6c332b59960f3a995802bded244750232f33713c49.css integrity="sha256-b2AFbUTT9+tppLxsMytZlg86mVgCve0kR1AjLzNxPEk=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://geowarin.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://geowarin.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://geowarin.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://geowarin.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://geowarin.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.89.2">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-46024908-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="What I Did Wrong as a CTO">
<meta property="og:description" content="I spent one year as a CTO for a startup. Here are some technical decisions I came to regret and those that I would make again in my next project">
<meta property="og:type" content="article">
<meta property="og:url" content="https://geowarin.github.io/what-i-did-wrong-as-a-cto/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2018-02-25T11:33:45+01:00">
<meta property="article:modified_time" content="2018-02-25T11:33:45+01:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="What I Did Wrong as a CTO">
<meta name=twitter:description content="I spent one year as a CTO for a startup. Here are some technical decisions I came to regret and those that I would make again in my next project">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://geowarin.github.io/post/"},{"@type":"ListItem","position":3,"name":"What I Did Wrong as a CTO","item":"https://geowarin.github.io/what-i-did-wrong-as-a-cto/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"What I Did Wrong as a CTO","name":"What I Did Wrong as a CTO","description":"I spent one year as a CTO for a startup. Here are some technical decisions I came to regret and those that I would make again in my next project","keywords":["kotlin","react","architecture","rest"],"articleBody":"Being a CTO in a startup is much more than the technical side.\nHowever, the technical decisions you make early with software, especially in a timed-constraint environment like a startup, tend to stick with you for the rest of the project.\nIn this article, I will be listing a few of the technical decisions I made.\nSome of them felt right at all time, some of them I hope not to make again.\nThe stack Our project was a SaaS management application. We wanted our users to have a great experience, to distinguish ourselves from the competition, and improve their productivity.\nWe used Kotlin and Spring Boot on the backend, React and Typescript on the frontend.\nI’m really comfortable with those technologies and that’s why I chose them.\nEven if you’re only using parts of our stack, I believe that some of the things I learned will be useful to you.\nIt felt right (would do again in my next project) Kotlin Kotlin is a fantastic language. It takes inspirations from scala, groovy, ruby, keeps the best parts, and has a top notch IDE support.\nThere were a few rough edges at the start of the project (IDE performance regressions, erratic behavior on language updates) but for the past few months I can say without reserve that Kotlin has been nothing but a joy to work with.\nKotlin is Java, had it been designed in the past few years instead of having 20 years of legacy. Kotlin is Scala, had it been designed to be a productivity powerhouse instead of an academic language.\nIt is pragmatic, elegant, and with very few footguns. It would be really painful for me to start a new project with Java instead of Kotlin.\nPostgres Postgres is an awesome database. Don’t listen to the bells and whistle of NoSQL. I’m completely sure that 90% of the web applications built in 2018 will not require advanced partitioning and clustering and will fit nicely in a relational database.\nIf you’re building a social network, it’s different of course, but otherwise, just take the best relational database. Your team will probably be at-ease with SQL and you will have the peace of mind of a database schema.\nJOOQ and Flyway JooQ is a java library which allows you to write type-safe SQL queries in Java.\nFlyway is a very simple tool that handles your database migrations using simple SQL files (there is a bit more to it, but the concepts are very easy to grasp).\nBoth are very well designed and it felt liberating to be in control of the SQL of the application. I came to realize how powerful SQL really is. All of a sudden it was a world with window functions, views, schemas, users, and more, that was open to us.\nI feel like I was never really in control of my schema when using JPA or other ORM tools in the past.\nTypescript and React For most of my career, I’ve worked with type-safe languages. I am 100% certain that they make me more productive. I can refactor my code and I have tremendous tools that empower me.\nOn the other hand, I have worked on a JS project without types for 2 years. It was a successful project with a lot of javascript and a great UX, but it was hard to crank up new features or change old code.\nI will never start a new project without typescript or flow. My heart tells me typescript is the right tool for me, but choosing any of the type-safe languages that compile to JS will make you more productive.\nThe only downside with typescript is finding type definitions for some libraries. There are not always of the best quality and you might have to copy, paste, and modify some locally to get the job done.\nI tend to have a bias towards libraries written in typescript: they come with type definitions and often have a better design.\nReact is a good library. I feel at ease with its API surface and I found that teaching React to newer developers is never too much of a burden.\nUsing a PaaS Don’t waste time setting up docker containers and a Kubernetes cluster. You just started your project, it does not have to handle billions of requests. You just need to publish your project in one command without headaches.\nWe used Pivotal Cloud Foundry and we would type cf push theApplication.jar and be done with our deployment.\nNo micro-services A good old monolith is all you want for the exact same reasons as the above.\nAlways strive for simplicity. You can create services later on when your startup is widely successful.\nMartin Fowler wrote a wonderful article called Monolith First that I encourage you to read.\nNot using webpack I have a lot of respect for the folks maintaining webpack. It is a good tool with unprecedented possibilities. That being said, when I set up the project, and despite my two years of webpack experience, I always felt like I was struggling with legacy software, and weird edge cases. I had to use or write custom plugins just to overcome the shortcomings of the tool.\nWebpack is getting better day after day but, for the sake of the project, I took a look at the competition.\nFor my JS build, I don’t want fancy configuration and a ton of plugins. I want something like spring-boot, with good defaults, and I want it to be fast out-of-the-box.\nWe used fuse-box, a very good bundler with an efficient cache. It is written in typescript and readily supports this language. Two decisive reasons for me.\nI never regretted trusting the fuse-box team, they’re doing a awesome job and they really listen to their community.\nThe other tool I am following closely is parcel. It auto-detects the features you need and provide an all-around pleasurable developer experience with no configuration. And it’s faster than Webpack.\nParcel is still in its infancy and I expect a few rough edges in the next months but I would probably give it a shot for my next project.\nIt felt weird (would probably not do again) Mobx and mobx-state-tree I love mobx. That’s why I’m a reluctant to list it in this category.\nIt feels simple and powerful and it is written in typescript.\nThose were compelling reasons for the choice of this library when I started the project.\nI have been working with Redux intensively on a past project and I found it required a lot of design and tools (boilerplate) to get the simplest features working.\nOn the other side of the spectrum, we have Mobx. You feel really strong when you design your first stores, because it just works.\nOn the other hand, edge cases are rough. Some libraries like react-table would just not behave.\nAfter using it for a year, I can probably list a few rules of thumbs:\n Create wrappers using  for libraries using shouldComponentUpdate aggressively, because they will mess up with the expectations of the developers Come up with strategies for serialization and deserialization early in the project with libraries like seriliazr.  But all of this has a cost in terms of code and mobx has a somewhat hidden learning curve that makes it difficult to grasp for junior developers.\nWe also tried mobx-state-tree and I love the ideas behind the library. It comes at a cost, though and this cost, at least for now, is performance.\nAll in all, choosing a state library for React is hard.\nThings to watch for in this area are immer and unstated.\nI still do not have the definitive answer to the question of state management in a React application. Remember there are no silver bullets and be careful when you design your frontend architecture early on.\nREST I have an idea of what a good rest API looks like.\nI think it involves a lot of design and bikeshedding.\nWhen a developer is in charge of a new feature, they always have a lot of choices to make:\n Should I add attributes to an existing REST resource? (overfetching) Should I add a new REST resource? (duplication) Should aggregate resources on the backend or the frontend? (inconsistency)  And I did not even talk about HATEOAS or documentation.\nCreating a good REST API is definitely something you should strive for and take the time to get right, if your business model requires it.\nOtherwise, I would consider GraphQL very seriously.\nIn our case, our model looked like a tree and not like small separated entities. That’s also something to consider.\nI feel that thinking your API in terms of a cluster of objects comes more naturally to developers. It favors emergent design and it encourages your developers and your business to get together and figure out the aggregates in your model.\nIf you want to go down this road early on and not even bother writing a fully-fledged backend server, I would review postgraphile and graphcool as great starting points.\nNot using “strict: true” with typescript Typescript is awesome, but you have to enable strict null checks to make the most of it. We started the project without strict checks and it was a significant endeavor to change it, so we never had the time to do it.\nEvery time we got an “X is undefined” error in the frontend, I regretted not adding strict: true to the typescript configuration at the start of the project.\nIt felt wrong (would never do again) Using an in memory database for tests and development We used Postgres in production and H2 (an in-memory database) for development and tests.\nWe had too many errors that we could only see after deploying the product to production.\nFortunately, most of them were easy to fix. The errors we saw the most were differences in ordering and grouping between the two DBMS.\nHence the rule: “every SQL query shall have an ORDER BY clause”.\n As Lukas Eder pointed out in the comments: If you don’t need ordering, you should always avoid it, as ordering mostly incurs an O(N log N) operations (apart from those rather rare cases where you can pull the data directly from an index).\n You can probably overcome those inconsistencies by setting up a CI build where your tests run against Postgres.\nBut more importantly, we were not able to take full advantage of features like window functions or JSON data types, to name a few.\nThe next time I’m starting a project I will use the same DBMS in development and in production.\nI feel that having a little docker-compose.yml at the root of your project, loose a little time (1 second) at the start of the day to boot it, and having a slightly worst developer experience is well worth the investment.\nServer-Side Rendering When building a Single Page App, you depend on your javascript to create the HTML that the user will interact with.\nWith Server-Side Rendering (SSR), you ask the server to run the javascript for the page that was requested, and then, send the resulting HTML directly to your clients.\nIt is believed that your users will have a better experience with this technique, especially on lower-end devices that will struggle to process big javascript files.\nIt is also believed that this wields better SEO results, as it easier for crawlers to parse HTML than to execute javascript.\nAt the beginning of the project, I was sure I could take advantage of SSR. I had set up a few projects in JS that leveraged SSR in the past, and studied libraries like nextjs carefully.\nOn the JVM, it is a bit less common, but I managed to pull something off using J2V8.\nThe truth is SSR is a trade-off and I think most web applications don’t need to invest time in server-rendered javascript.\nBesides, measuring the benefits of SSR is really tricky. You have to consider different metrics than the “time to render”. Take, for example, time to interactive.\nIt is a fascinating subject but it was foolish to spend time on this matter as SEO and slow processors were clearly not a priority for the business.\nRemoving Server-Side Rendering was a good call, and reduced the overall complexity of the server code.\nThat being said, there is room for a tool that would simplify SSR on the JVM. It would be a amazing side project if you’re interested in the challenge.\nService layer Not spending enough time on the simplest aspect of the architecture was something I came to regret a few months into the project with multiple people working on the code.\nMake sure that every layer has clear boundaries and do not hesitate to split your project in small modules early on.\nFor example, these modules can be a good starting point:\n model: mapping with your database and helpers services: fetching and updating your database, only exports higher-level functions like Graphql endpoints web-backend: things that depend on HTTP libraries web-frontend: JS stuff  Modules are a great way to enforce architectural decisions. Moreover, you can only use the internal keyword in Kotlin by splitting your code into modules.\nLater in the project, when you figure out cluster of domain objects that work together well, you should also split the service layer into smaller modules.\nGood examples might be the “order module”, the “transaction module”, or the “security module” depending on your domain.\nI like to thing of this approach as a stepping stone towards “micro-services”, without the complexity of deploying them as separate network entities.\nThere is actually a continuum between an integrated system and a distributed system and you probably won’t have to cross the line.\nFor more insights, I recommend watching the Majestic Modular Monoliths talk by Axel Fontaine.\nConclusion Your time is precious, you don’t want to be spending it unwisely or come to regret too many engineering decisions later.\nOnly experience can make you aware of the tradeoffs you will make in the early stages of a product. I hope that mine will help you avoid some traps and make better choices when designing a greenfield project.\n","wordCount":"2364","inLanguage":"en","datePublished":"2018-02-25T11:33:45+01:00","dateModified":"2018-02-25T11:33:45+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://geowarin.github.io/what-i-did-wrong-as-a-cto/"},"publisher":{"@type":"Organization","name":"Geowarin","logo":{"@type":"ImageObject","url":"https://geowarin.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://geowarin.github.io accesskey=h title="Geowarin (Alt + H)">Geowarin</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://geowarin.github.io/archive/ title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://geowarin.github.io/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
<li>
<a href=https://geowarin.github.io/mastering-spring-mvc-4/ title=Book>
<span>Book</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://geowarin.github.io>Home</a>&nbsp;»&nbsp;<a href=https://geowarin.github.io/post/>Posts</a></div>
<h1 class=post-title>
What I Did Wrong as a CTO
</h1>
<div class=post-meta><span title="2018-02-25 11:33:45 +0100 +0100">February 25, 2018</span>&nbsp;·&nbsp;12 min
</div>
</header>
<div class=post-content><p>Being a CTO in a startup is much more than the technical side.</p>
<p>However, the technical decisions you make early with software, especially in a timed-constraint environment like a startup,
tend to stick with you for the rest of the project.</p>
<p>In this article, I will be listing a few of the technical decisions I made.</p>
<p>Some of them felt right at all time, some of them I hope not to make again.</p>
<h1 id=the-stack>The stack<a hidden class=anchor aria-hidden=true href=#the-stack>#</a></h1>
<p>Our project was a SaaS management application. We wanted our users to have a great experience, to distinguish ourselves
from the competition, and improve their productivity.</p>
<p>We used Kotlin and Spring Boot on the backend, React and Typescript on the frontend.</p>
<p>I&rsquo;m really comfortable with those technologies and that&rsquo;s why I chose them.</p>
<p>Even if you&rsquo;re only using parts of our stack, I believe that some of the things I learned will be useful to you.</p>
<h1 id=it-felt-right-would-do-again-in-my-next-project>It felt right (would do again in my next project)<a hidden class=anchor aria-hidden=true href=#it-felt-right-would-do-again-in-my-next-project>#</a></h1>
<h2 id=kotlin>Kotlin<a hidden class=anchor aria-hidden=true href=#kotlin>#</a></h2>
<p>Kotlin is a fantastic language. It takes inspirations from scala, groovy, ruby, keeps the best parts, and has a top notch
IDE support.</p>
<p>There were a few rough edges at the start of the project (IDE performance regressions, erratic behavior on language updates)
but for the past few months I can say without reserve that Kotlin has been nothing but a joy to work with.</p>
<p>Kotlin is Java, had it been designed in the past few years instead of having 20 years of legacy.
Kotlin is Scala, had it been designed to be a productivity powerhouse instead of an academic language.</p>
<p>It is pragmatic, elegant, and with very few footguns. It would be really painful for me to start a new project with
Java instead of Kotlin.</p>
<h2 id=postgres>Postgres<a hidden class=anchor aria-hidden=true href=#postgres>#</a></h2>
<p>Postgres is an awesome database. Don&rsquo;t listen to the bells and whistle of NoSQL. I&rsquo;m completely sure that 90% of the
web applications built in 2018 will not require advanced partitioning and clustering and will fit nicely in a relational
database.</p>
<p>If you&rsquo;re building a social network, it&rsquo;s different of course, but otherwise, just take the best relational database.
Your team will probably be at-ease with SQL and you will have the peace of mind of a database schema.</p>
<h2 id=jooq-and-flyway>JOOQ and Flyway<a hidden class=anchor aria-hidden=true href=#jooq-and-flyway>#</a></h2>
<p><a href=https://www.jooq.org/>JooQ</a> is a java library which allows you to write type-safe SQL queries in Java.</p>
<p><a href=https://flywaydb.org/>Flyway</a> is a very simple tool that handles your database migrations using simple SQL files
(there is a bit more to it, but the concepts are very easy to grasp).</p>
<p>Both are very well designed and it felt liberating to be in control of the SQL of the application.
I came to realize how powerful SQL really is.
All of a sudden it was a world with window functions, views, schemas, users, and more, that was open to us.</p>
<p>I feel like I was never really in control of my schema when using JPA or other ORM tools in the past.</p>
<h2 id=typescript-and-react>Typescript and React<a hidden class=anchor aria-hidden=true href=#typescript-and-react>#</a></h2>
<p>For most of my career, I&rsquo;ve worked with type-safe languages. I am 100% certain that they make me more productive.
I can refactor my code and I have tremendous tools that empower me.</p>
<p>On the other hand, I have worked on a JS project without types for 2 years.
It was a successful project with a lot of javascript and a great UX, but it was hard to crank up new features or
change old code.</p>
<p>I will never start a new project without typescript or flow. My heart tells me typescript is the right tool for me, but
choosing any of the type-safe languages that compile to JS will make you more productive.</p>
<p>The only downside with typescript is finding type definitions for some libraries. There are not always of the best quality
and you might have to copy, paste, and modify some locally to get the job done.</p>
<p>I tend to have a bias towards libraries written in typescript: they come with type definitions and often have a better design.</p>
<p>React is a good library. I feel at ease with its API surface and I found that teaching React to newer developers is never
too much of a burden.</p>
<h2 id=using-a-paas>Using a PaaS<a hidden class=anchor aria-hidden=true href=#using-a-paas>#</a></h2>
<p>Don&rsquo;t waste time setting up docker containers and a Kubernetes cluster. You just started your project, it does not have
to handle billions of requests. You just need to publish your project in one command without headaches.</p>
<p>We used <a href=https://pivotal.io/platform>Pivotal Cloud Foundry</a> and we would type <code>cf push theApplication.jar</code> and be done
with our deployment.</p>
<h2 id=no-micro-services>No micro-services<a hidden class=anchor aria-hidden=true href=#no-micro-services>#</a></h2>
<p>A good old monolith is all you want for the exact same reasons as the above.</p>
<p>Always strive for simplicity. You can create services later on when your startup is widely successful.</p>
<p>Martin Fowler wrote a wonderful article called <a href=https://www.martinfowler.com/bliki/MonolithFirst.html>Monolith First</a>
that I encourage you to read.</p>
<h2 id=not-using-webpack>Not using webpack<a hidden class=anchor aria-hidden=true href=#not-using-webpack>#</a></h2>
<p>I have a lot of respect for the folks maintaining webpack. It is a good tool with unprecedented possibilities.
That being said, when I set up the project, and despite my two years of webpack experience, I always felt like I was
struggling with legacy software, and weird edge cases.
I had to use or write custom plugins just to overcome the shortcomings of the tool.</p>
<p>Webpack is getting better day after day but, for the sake of the project, I took a look at the competition.</p>
<p>For my JS build, I don&rsquo;t want fancy configuration and a ton of plugins.
I want something like spring-boot, with good defaults, and I want it to be fast out-of-the-box.</p>
<p>We used <a href=https://fuse-box.org/>fuse-box</a>, a very good bundler with an efficient cache.
It is written in typescript and readily supports this language. Two decisive reasons for me.</p>
<p>I never regretted trusting the fuse-box team, they&rsquo;re doing a awesome job and they really listen to their community.</p>
<p>The other tool I am following closely is <a href=https://parceljs.org/>parcel</a>.
It auto-detects the features you need and provide an all-around pleasurable developer experience with no configuration.
And it&rsquo;s faster than Webpack.</p>
<p>Parcel is still in its infancy and I expect a few rough edges in the next months but I would probably give it a shot for my
next project.</p>
<h1 id=it-felt-weird-would-probably-not-do-again>It felt weird (would probably not do again)<a hidden class=anchor aria-hidden=true href=#it-felt-weird-would-probably-not-do-again>#</a></h1>
<h2 id=mobx-and-mobx-state-tree>Mobx and mobx-state-tree<a hidden class=anchor aria-hidden=true href=#mobx-and-mobx-state-tree>#</a></h2>
<p>I love <a href=https://mobx.js.org/>mobx</a>. That&rsquo;s why I&rsquo;m a reluctant to list it in this category.</p>
<p>It feels simple and powerful and it is written in typescript.</p>
<p>Those were compelling reasons for the choice of this library when I started the project.</p>
<p>I have been working with Redux intensively on a past project and I found it required a lot of design and tools (boilerplate)
to get the simplest features working.</p>
<p>On the other side of the spectrum, we have Mobx. You feel really strong when you design your first stores, because
it just works.</p>
<p>On the other hand, edge cases are rough. Some libraries like react-table would just not behave.</p>
<p>After using it for a year, I can probably list a few rules of thumbs:</p>
<ul>
<li>Create wrappers using <code>&lt;Observer /></code> for libraries using <code>shouldComponentUpdate</code> aggressively, because they will mess up
with the expectations of the developers</li>
<li>Come up with strategies for serialization and deserialization early in the project with libraries like <a href=https://github.com/mobxjs/serializr>seriliazr</a>.</li>
</ul>
<p>But all of this has a cost in terms of code and mobx has a somewhat hidden learning curve that makes it difficult to grasp for junior
developers.</p>
<p>We also tried <a href=https://github.com/mobxjs/mobx-state-tree/>mobx-state-tree</a> and I love the ideas behind the library.
It comes at a cost, though and this cost, at least for now, <a href=https://github.com/mobxjs/mobx-state-tree/issues/440>is performance</a>.</p>
<p>All in all, choosing a state library for React is hard.</p>
<p>Things to watch for in this area are <a href=https://github.com/mweststrate/immer>immer</a> and <a href=https://github.com/jamiebuilds/unstated>unstated</a>.</p>
<p>I still do not have the definitive answer to the question of state management in a React application.
Remember there are no silver bullets and be careful when you design your frontend architecture early on.</p>
<h2 id=rest>REST<a hidden class=anchor aria-hidden=true href=#rest>#</a></h2>
<p>I have an idea of what a good rest API looks like.</p>
<p>I think it involves a lot of design and bikeshedding.</p>
<p>When a developer is in charge of a new feature, they always have a lot of choices to make:</p>
<ul>
<li>Should I add attributes to an existing REST resource? (overfetching)</li>
<li>Should I add a new REST resource? (duplication)</li>
<li>Should aggregate resources on the backend or the frontend? (inconsistency)</li>
</ul>
<p>And I did not even talk about HATEOAS or documentation.</p>
<p>Creating a good REST API is definitely something you should strive for and take the time to get right, if your business
model requires it.</p>
<p>Otherwise, I would consider <a href=http://graphql.org/>GraphQL</a> very seriously.</p>
<p>In our case, our model looked like a tree and not like small separated entities. That&rsquo;s also something to consider.</p>
<p>I feel that thinking your API in terms of a cluster of objects comes more naturally to developers.
It favors emergent design and it encourages your developers and your business to get together and figure out the
<a href=https://www.martinfowler.com/bliki/DDD_Aggregate.html>aggregates</a> in your model.</p>
<p>If you want to go down this road early on and not even bother writing a fully-fledged backend server, I would review
<a href=https://github.com/graphile/postgraphile>postgraphile</a> and <a href=https://www.graph.cool>graphcool</a> as great starting points.</p>
<h2 id=not-using-strict-true-with-typescript>Not using &ldquo;strict: true&rdquo; with typescript<a hidden class=anchor aria-hidden=true href=#not-using-strict-true-with-typescript>#</a></h2>
<p>Typescript is awesome, but you have to enable <a href=https://basarat.gitbooks.io/typescript/docs/options/strictNullChecks.html>strict null checks</a>
to make the most of it.
We started the project without strict checks and it was a significant endeavor to change it, so we never had the time
to do it.</p>
<p>Every time we got an &ldquo;X is undefined&rdquo; error in the frontend, I regretted not adding <code>strict: true</code> to the typescript
configuration at the start of the project.</p>
<h1 id=it-felt-wrong-would-never-do-again>It felt wrong (would never do again)<a hidden class=anchor aria-hidden=true href=#it-felt-wrong-would-never-do-again>#</a></h1>
<h2 id=using-an-in-memory-database-for-tests-and-development>Using an in memory database for tests and development<a hidden class=anchor aria-hidden=true href=#using-an-in-memory-database-for-tests-and-development>#</a></h2>
<p>We used Postgres in production and H2 (an in-memory database) for development and tests.</p>
<p>We had too many errors that we could only see after deploying the product to production.</p>
<p>Fortunately, most of them were easy to fix.
The errors we saw the most were differences in ordering and grouping between the two DBMS.</p>
<p>Hence the rule: &ldquo;every SQL query shall have an ORDER BY clause&rdquo;.</p>
<blockquote>
<p>As Lukas Eder pointed out in the comments:
If you don&rsquo;t need ordering, you should always avoid it, as ordering mostly incurs an O(N log N) operations
(apart from those rather rare cases where you can pull the data directly from an index).</p>
</blockquote>
<p>You can probably overcome those inconsistencies by setting up a CI build where your tests run against Postgres.</p>
<p>But more importantly, we were not able to take full advantage of features like
<a href=https://blog.jooq.org/2013/11/03/probably-the-coolest-sql-feature-window-functions/>window functions</a> or
<a href=https://www.compose.com/articles/is-postgresql-your-next-json-database/>JSON data types</a>, to name a few.</p>
<p>The next time I&rsquo;m starting a project I will use the same DBMS in development and in production.</p>
<p>I feel that having a little <code>docker-compose.yml</code> at the root of your project, loose a little time (1 second) at the
start of the day to boot it, and having a slightly worst developer experience is well worth the investment.</p>
<h2 id=server-side-rendering>Server-Side Rendering<a hidden class=anchor aria-hidden=true href=#server-side-rendering>#</a></h2>
<p>When building a Single Page App, you depend on your javascript to create the HTML that the user will interact with.</p>
<p>With Server-Side Rendering (SSR), you ask the server to run the javascript for the page that was requested, and then, send the resulting
HTML directly to your clients.</p>
<p>It is believed that your users will have a better experience with this technique, especially on lower-end devices that
will struggle to process big javascript files.</p>
<p>It is also believed that this wields better SEO results, as it easier for crawlers to parse HTML than to execute javascript.</p>
<p>At the beginning of the project, I was sure I could take advantage of SSR.
I had set up a few projects in JS that leveraged SSR in the past, and studied libraries like
<a href=https://zeit.co/blog/next>nextjs</a> carefully.</p>
<p>On the JVM, it is a bit less common, but I managed to pull something off using <a href=https://github.com/eclipsesource/J2V8/>J2V8</a>.</p>
<p>The truth is SSR is a trade-off and I think most web applications don&rsquo;t need to invest time in server-rendered
javascript.</p>
<p>Besides, measuring the benefits of SSR is really tricky. You have to consider different metrics than the &ldquo;time to render&rdquo;.
Take, for example, <a href=https://developers.google.com/web/tools/lighthouse/audits/time-to-interactive>time to interactive</a>.</p>
<p>It is a fascinating subject but it was foolish to spend time on this matter as SEO and slow processors were clearly
not a priority for the business.</p>
<p>Removing Server-Side Rendering was a good call, and reduced the overall complexity of the server code.</p>
<p>That being said, there is room for a tool that would simplify SSR on the JVM. It would be a amazing side project if you&rsquo;re
interested in the challenge.</p>
<h2 id=service-layer>Service layer<a hidden class=anchor aria-hidden=true href=#service-layer>#</a></h2>
<p>Not spending enough time on the simplest aspect of the architecture was something I came to regret a few months into
the project with multiple people working on the code.</p>
<p>Make sure that every layer has clear boundaries and do not hesitate to split your project in small modules early on.</p>
<p>For example, these modules can be a good starting point:</p>
<ul>
<li><code>model</code>: mapping with your database and helpers</li>
<li><code>services</code>: fetching and updating your database, only exports higher-level functions like Graphql endpoints</li>
<li><code>web-backend</code>: things that depend on HTTP libraries</li>
<li><code>web-frontend</code>: JS stuff</li>
</ul>
<p>Modules are a great way to enforce architectural decisions.
Moreover, you can only use the <code>internal</code> <a href=https://kotlinlang.org/docs/reference/visibility-modifiers.html>keyword</a>
in Kotlin by splitting your code into modules.</p>
<p>Later in the project, when you figure out cluster of domain objects that work together well, you should also split the service
layer into smaller modules.</p>
<p>Good examples might be the &ldquo;order module&rdquo;, the &ldquo;transaction module&rdquo;, or the &ldquo;security module&rdquo; depending on your domain.</p>
<p>I like to thing of this approach as a stepping stone towards &ldquo;micro-services&rdquo;, without the complexity of deploying them
as separate network entities.</p>
<p>There is actually a continuum between an integrated system and a distributed system and you probably won&rsquo;t have to
cross the line.</p>
<p>For more insights, I recommend watching the <a href=https://speakerdeck.com/axelfontaine/majestic-modular-monoliths>Majestic Modular Monoliths</a>
talk by Axel Fontaine.</p>
<h1 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h1>
<p>Your time is precious, you don&rsquo;t want to be spending it unwisely or come to regret too many engineering decisions later.</p>
<p>Only experience can make you aware of the tradeoffs you will make in the early stages of a product. I hope that
mine will help you avoid some traps and make better choices when designing a greenfield project.</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://geowarin.github.io/tags/kotlin/>kotlin</a></li>
<li><a href=https://geowarin.github.io/tags/react/>react</a></li>
<li><a href=https://geowarin.github.io/tags/architecture/>architecture</a></li>
<li><a href=https://geowarin.github.io/tags/rest/>rest</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://geowarin.github.io/debugging-webflux-with-intellij/>
<span class=title>« Prev Page</span>
<br>
<span>Debugging Webflux with IntelliJ</span>
</a>
<a class=next href=https://geowarin.github.io/consuming-apis-with-redux-the-shasta-way/>
<span class=title>Next Page »</span>
<br>
<span>Consuming APIs with Redux, the Shasta way</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share What I Did Wrong as a CTO on twitter" href="https://twitter.com/intent/tweet/?text=What%20I%20Did%20Wrong%20as%20a%20CTO&url=https%3a%2f%2fgeowarin.github.io%2fwhat-i-did-wrong-as-a-cto%2f&hashtags=kotlin%2creact%2carchitecture%2crest"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share What I Did Wrong as a CTO on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fgeowarin.github.io%2fwhat-i-did-wrong-as-a-cto%2f&title=What%20I%20Did%20Wrong%20as%20a%20CTO&summary=What%20I%20Did%20Wrong%20as%20a%20CTO&source=https%3a%2f%2fgeowarin.github.io%2fwhat-i-did-wrong-as-a-cto%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share What I Did Wrong as a CTO on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fgeowarin.github.io%2fwhat-i-did-wrong-as-a-cto%2f&title=What%20I%20Did%20Wrong%20as%20a%20CTO"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share What I Did Wrong as a CTO on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fgeowarin.github.io%2fwhat-i-did-wrong-as-a-cto%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share What I Did Wrong as a CTO on whatsapp" href="https://api.whatsapp.com/send?text=What%20I%20Did%20Wrong%20as%20a%20CTO%20-%20https%3a%2f%2fgeowarin.github.io%2fwhat-i-did-wrong-as-a-cto%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share What I Did Wrong as a CTO on telegram" href="https://telegram.me/share/url?text=What%20I%20Did%20Wrong%20as%20a%20CTO&url=https%3a%2f%2fgeowarin.github.io%2fwhat-i-did-wrong-as-a-cto%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer><div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//geowarin.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://geowarin.github.io>Geowarin</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>