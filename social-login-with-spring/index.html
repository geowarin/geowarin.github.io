<!doctype html><html lang=en dir=auto><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Log-in with your social account in your Spring application">
<meta name=theme-color content="#ffcd00">
<meta property="og:title" content="Social login with Spring • Geowarin">
<meta property="og:description" content="Log-in with your social account in your Spring application">
<meta property="og:url" content="https://geowarin.github.io/social-login-with-spring/">
<meta property="og:site_name" content="Geowarin">
<meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:tag" content="spring"><meta property="article:tag" content="social"><meta property="article:tag" content="login"><meta property="article:published_time" content="2016-02-12T00:00:00Z"><meta property="article:modified_time" content="2016-02-12T00:00:00Z"><meta name=twitter:card content="summary"><meta name=twitter:site content="@geowarin">
<meta name=generator content="Hugo 0.89.2">
<title>Social login with Spring • Geowarin</title>
<link rel=canonical href=https://geowarin.github.io/social-login-with-spring/>
<link rel=icon href=/favicon.ico>
<link rel=stylesheet href=/assets/css/main.ab98e12b.css><link rel=stylesheet href=/css/custom.css><style>:root{--color-accent:#ffcd00}</style>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-46024908-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</head>
<body class="page type-post has-sidebar">
<div class=site><div id=sidebar class=sidebar>
<a class=screen-reader-text href=#main-menu>Skip to Main Menu</a>
<div class=container><section class="widget widget-about sep-after">
<header>
<div class=logo>
<a href=/>
<img src=/images/logo.png>
</a>
</div>
<h2 class="title site-title">
<a href=/>
Geowarin
</a>
</h2>
<div class=desc>
Web developer
</div>
</header>
</section>
<section class="widget widget-search sep-after">
<header>
<h4 class="title widget-title">Search</h4>
</header>
<form action=/search id=search-form class=search-form>
<label>
<span class=screen-reader-text>Search</span>
<input id=search-term class=search-term type=search name=q placeholder=Search&mldr;>
</label></form>
</section>
<section class="widget widget-social_menu sep-after"><nav aria-label="Social Menu">
<ul><li>
<a href=https://github.com/geowarin target=_blank rel="noopener me">
<span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a>
</li><li>
<a href=https://twitter.com/geowarin target=_blank rel="noopener me">
<span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg>
</a>
</li><li>
<a href=https://linkedin.com/in/geowarin target=_blank rel="noopener me">
<span class=screen-reader-text>Open Linkedin account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
</a>
</li></ul>
</nav>
</section></div>
<div class=sidebar-overlay></div>
</div><div class=main><nav id=main-menu class="menu main-menu" aria-label="Main Menu">
<div class=container>
<a class=screen-reader-text href=#content>Skip to Content</a>
<button id=sidebar-toggler class=sidebar-toggler aria-controls=sidebar>
<span class=screen-reader-text>Toggle Sidebar</span>
<span class=open><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</span>
<span class=close><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
</span>
</button>
<ul><li class=item>
<a href=/>Blog</a>
</li><li class=item>
<a href=/archive/>Archive</a>
</li><li class=item>
<a href=/mastering-spring-mvc-4/>Book</a>
</li><li class=item>
<a href=https://github.com/geowarin/blog-src>Repo</a>
</li></ul>
</div>
</nav><div class=header-widgets>
<div class=container>
<style>.widget-breadcrumbs li:after{content:'\2f '}</style>
<section class="widget widget-breadcrumbs sep-after">
<nav id=breadcrumbs>
<ol><li><a href=/>Geowarin</a></li><li><a href=/post/>Posts</a></li><li><span>Social login with Spring</span></li></ol>
</nav>
</section></div>
</div>
<header id=header class="header site-header">
<div class="container sep-after">
<div class=header-info><p class="site-title title">Geowarin</p><p class="desc site-desc">Web developer</p>
</div>
</div>
</header>
<main id=content>
<article lang=en class=entry>
<header class="header entry-header">
<div class="container sep-after">
<div class=header-info>
<h1 class=title>Social login with Spring</h1>
<p class=desc>Log-in with your social account in your Spring application</p>
</div>
<div class=entry-meta>
<span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
<span class=screen-reader-text>Posted on </span>
<time class=entry-date datetime=2016-02-12T00:00:00Z>2016, Feb 12</time>
</span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>
7 mins read
</span>
</div>
</div>
</header>
<div class="container entry-content">
<p>Nowadays, it&rsquo;s getting rare and even a bit annoying when a service rolls up its own
authentication mechanism instead of relying on a OAuth sign-on with our social
networks.</p>
<p>Login via social networks means fewer passwords to remember, and stronger guarantees
in terms of security because you can check and control the authorizations of the applications
you use.</p>
<p>In this article, I will show you how to allow users to log into your application
via Twitter from a rich Javascript client (React).</p>
<p>We will also persist our users connections in database.</p>
<p>The code is available <a href=https://github.com/geowarin/boot-social-api>on github</a>.</p>
<h2 id=setting-up-your-app-on-twitter>Setting up your app on Twitter</h2>
<p>Before coding anything, you will need to create a new Twitter application
in <a href=https://apps.twitter.com/>your twitter apps page</a>.</p>
<p><img src=/assets/images/articles/2016-02-twitter-app.png alt="Creating a Twitter app" title="Creating a Twitter app"></p>
<p>Then go to the &ldquo;Keys and access tokens&rdquo; tab and note your API key and API secret
ids.</p>
<p><img src=/assets/images/articles/2016-02-twitter-app-keys.png alt="Twitter app keys" title="Twitter app keys"></p>
<h2 id=creating-a-spring-boot-app>Creating a Spring Boot app</h2>
<p>Use the <a href=http://start.spring.io>Spring initializer</a> to create a new Spring Boot
application. You will need the following dependencies:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>dependencies <span style=color:#f92672>{</span>
	compile<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-devtools&#39;</span><span style=color:#f92672>)</span>
	compile<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-security&#39;</span><span style=color:#f92672>)</span>
	compile<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-social-twitter&#39;</span><span style=color:#f92672>)</span>
	compile<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-web&#39;</span><span style=color:#f92672>)</span>
	compile<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-jdbc&#39;</span><span style=color:#f92672>)</span>
	compile<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;com.h2database:h2&#39;</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Please copy your <code>appId</code> and <code>appSecret</code> in the <code>application.properties</code> file and
configure a few things:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#a6e22e>spring.social.twitter.appId</span><span style=color:#f92672>=</span> <span style=color:#e6db74>&lt;Consumer Key&gt;</span>
<span style=color:#a6e22e>spring.social.twitter.appSecret</span><span style=color:#f92672>=</span> <span style=color:#e6db74>&lt;Consumer Secret&gt;</span>
<span style=color:#75715e># Disable auto views, we are making an API</span>
<span style=color:#a6e22e>spring.social.auto-connection-views</span><span style=color:#f92672>=</span><span style=color:#e6db74>false</span>
<span style=color:#75715e># Disable basic security</span>
<span style=color:#a6e22e>security.basic.enabled</span><span style=color:#f92672>=</span><span style=color:#e6db74>false</span>
<span style=color:#75715e># Persist H2 data to disk to keep connection info between reboots</span>
<span style=color:#a6e22e>spring.datasource.url</span><span style=color:#f92672>=</span><span style=color:#e6db74>jdbc:h2:~/social-test</span>
</code></pre></div><h2 id=sign-in-and-sign-up-flows>Sign-in and Sign-up flows</h2>
<p>Spring social has two different flows when someone logs into your app via social
networks.</p>
<p>The first time someone logs into your application, they will go through the sign-up flow.
If their ID already registered in Spring Social, they will go through the sign-in
flow instead.</p>
<p>You job is to create a <code>SignInAdapter</code> that will handle the sign-in process and
a controller that will decide what to do during the sign-up process (you will receive a
request on the <code>/signup</code> URL by default).</p>
<p>Here is an overview of the authentication flow in Spring Social:</p>
<p><img src=/assets/images/articles/2016-02-social-flow.png alt="Spring Social flow" title="Spring Social flow"></p>
<ul>
<li>Your application produces a POST request to <code>/signin/{providerId}</code></li>
<li>The <code>ProviderSigninController</code> then redirects the user to the identification provider&rsquo;s sign-in screen</li>
<li>The user logs in</li>
<li>The identification provider will send the OAuth token with GET request to <code>/signin/{providerId}</code></li>
<li>If the user is not found in the <code>UsersConnectionRepository</code>, the controller will use a <code>SessionStrategy</code> to store the pending login request and will then redirect to the signupUrl page</li>
<li>If the user is found, your <code>SignInAdapter</code> interface is called</li>
</ul>
<p>If you want to know more details about Spring social inner workings, check the <code>SocialWebAutoConfiguration</code> class of Spring Boot and the <code>ProviderSignInController</code> class
of Spring Social.</p>
<p>In the above diagram, we can see that we have two more extensions points:</p>
<ul>
<li>The <code>SessionStrategy</code>. By default, it stores temporary information about the connection
in the HTTP session</li>
<li>The <code>UsersConnectionRepository</code>. By default, Spring boot provides an <code>InMemoryUsersConnectionRepository</code>. Connections will be lost when your application
reboots.</li>
</ul>
<h2 id=spring-security-config>Spring Security Config</h2>
<p>We need to enable security in our application. Let&rsquo;s create a classic security
configuration.
It will make sure that users using our REST api are authenticated but will let calls
to <code>/api/session</code>, our authentication end point, go through:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Configuration</span>
<span style=color:#a6e22e>@Order</span><span style=color:#f92672>(</span>SecurityProperties<span style=color:#f92672>.</span><span style=color:#a6e22e>ACCESS_OVERRIDE_ORDER</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecurityConfiguration</span> <span style=color:#66d9ef>extends</span> WebSecurityConfigurerAdapter <span style=color:#f92672>{</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>(</span>HttpSecurity http<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
        http
                <span style=color:#f92672>.</span><span style=color:#a6e22e>authorizeRequests</span><span style=color:#f92672>()</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>antMatchers</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/api/session&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>permitAll</span><span style=color:#f92672>()</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>antMatchers</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/h2-console/**&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>permitAll</span><span style=color:#f92672>()</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>antMatchers</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/api/**&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>authenticated</span><span style=color:#f92672>()</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>and</span><span style=color:#f92672>()</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>headers</span><span style=color:#f92672>().</span><span style=color:#a6e22e>frameOptions</span><span style=color:#f92672>().</span><span style=color:#a6e22e>disable</span><span style=color:#f92672>()</span> <span style=color:#75715e>// for h2
</span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>and</span><span style=color:#f92672>()</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>requestCache</span><span style=color:#f92672>()</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>requestCache</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> NullRequestCache<span style=color:#f92672>())</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>and</span><span style=color:#f92672>()</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>sessionManagement</span><span style=color:#f92672>().</span><span style=color:#a6e22e>sessionCreationPolicy</span><span style=color:#f92672>(</span>SessionCreationPolicy<span style=color:#f92672>.</span><span style=color:#a6e22e>IF_REQUIRED</span><span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>and</span><span style=color:#f92672>().</span><span style=color:#a6e22e>csrf</span><span style=color:#f92672>().</span><span style=color:#a6e22e>disable</span><span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>The authentication end point is very simple. It provides a way to <code>GET</code> the
current session and to <code>DELETE</code> it to logout:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@RestController</span>
<span style=color:#a6e22e>@RequestMapping</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/api/session&#34;</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AuthenticationResource</span> <span style=color:#f92672>{</span>
    <span style=color:#a6e22e>@Autowired</span>
    AuthenticationManager authenticationManager<span style=color:#f92672>;</span>

    <span style=color:#a6e22e>@RequestMapping</span><span style=color:#f92672>(</span>method <span style=color:#f92672>=</span> RequestMethod<span style=color:#f92672>.</span><span style=color:#a6e22e>GET</span><span style=color:#f92672>)</span>
    <span style=color:#66d9ef>public</span> User <span style=color:#a6e22e>session</span><span style=color:#f92672>(</span>Principal user<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        String name <span style=color:#f92672>=</span> user <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>:</span> user<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>();</span>
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> User<span style=color:#f92672>(</span>name<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@RequestMapping</span><span style=color:#f92672>(</span>method <span style=color:#f92672>=</span> RequestMethod<span style=color:#f92672>.</span><span style=color:#a6e22e>DELETE</span><span style=color:#f92672>)</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>logout</span><span style=color:#f92672>(</span>HttpSession session<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        session<span style=color:#f92672>.</span><span style=color:#a6e22e>invalidate</span><span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><h2 id=sign-in>Sign-in</h2>
<p>To handle the sign-in, we need to provide a <code>SignInAdapter</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Configuration</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SocialConfiguration</span> <span style=color:#f92672>{</span>

    <span style=color:#a6e22e>@Bean</span>
    <span style=color:#66d9ef>public</span> SignInAdapter <span style=color:#a6e22e>authSignInAdapter</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>userId<span style=color:#f92672>,</span> connection<span style=color:#f92672>,</span> request<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
            AuthUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>authenticate</span><span style=color:#f92672>(</span>connection<span style=color:#f92672>);</span>
            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
        <span style=color:#f92672>};</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>We can create a simple <code>authenticate</code> method that will take a Social <code>Connection</code>
and authenticate the user using Spring Security&rsquo;s context:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AuthUtil</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> Logger log <span style=color:#f92672>=</span> LoggerFactory<span style=color:#f92672>.</span><span style=color:#a6e22e>getLogger</span><span style=color:#f92672>(</span>AuthUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>authenticate</span><span style=color:#f92672>(</span>Connection<span style=color:#f92672>&lt;?&gt;</span> connection<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        UserProfile userProfile <span style=color:#f92672>=</span> connection<span style=color:#f92672>.</span><span style=color:#a6e22e>fetchUserProfile</span><span style=color:#f92672>();</span>
        String username <span style=color:#f92672>=</span> userProfile<span style=color:#f92672>.</span><span style=color:#a6e22e>getUsername</span><span style=color:#f92672>();</span>
        UsernamePasswordAuthenticationToken authentication <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> UsernamePasswordAuthenticationToken<span style=color:#f92672>(</span>username<span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
        SecurityContextHolder<span style=color:#f92672>.</span><span style=color:#a6e22e>getContext</span><span style=color:#f92672>().</span><span style=color:#a6e22e>setAuthentication</span><span style=color:#f92672>(</span>authentication<span style=color:#f92672>);</span>
        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;User {} {} connected.&#34;</span><span style=color:#f92672>,</span> userProfile<span style=color:#f92672>.</span><span style=color:#a6e22e>getFirstName</span><span style=color:#f92672>(),</span> userProfile<span style=color:#f92672>.</span><span style=color:#a6e22e>getLastName</span><span style=color:#f92672>());</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Note that we have access to our user&rsquo;s profile with the <code>Connection</code>
object.</p>
<h2 id=sign-up>Sign-up</h2>
<p>Here is a simple implementation of a signup controller:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Controller</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SignupController</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> ProviderSignInUtils signInUtils<span style=color:#f92672>;</span>

    <span style=color:#a6e22e>@Autowired</span>
    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>SignupController</span><span style=color:#f92672>(</span>ConnectionFactoryLocator connectionFactoryLocator<span style=color:#f92672>,</span> UsersConnectionRepository connectionRepository<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        signInUtils <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ProviderSignInUtils<span style=color:#f92672>(</span>connectionFactoryLocator<span style=color:#f92672>,</span> connectionRepository<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@RequestMapping</span><span style=color:#f92672>(</span>value <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/signup&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>signup</span><span style=color:#f92672>(</span>WebRequest request<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        Connection<span style=color:#f92672>&lt;?&gt;</span> connection <span style=color:#f92672>=</span> signInUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>getConnectionFromSession</span><span style=color:#f92672>(</span>request<span style=color:#f92672>);</span>
        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>connection <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
            AuthUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>authenticate</span><span style=color:#f92672>(</span>connection<span style=color:#f92672>);</span>
            signInUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>doPostSignUp</span><span style=color:#f92672>(</span>connection<span style=color:#f92672>.</span><span style=color:#a6e22e>getDisplayName</span><span style=color:#f92672>(),</span> request<span style=color:#f92672>);</span>
        <span style=color:#f92672>}</span>
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;redirect:/&#34;</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>There are two things to note here:</p>
<ul>
<li>Spring lets us decide what to do the first time we register a user. In this
example, we just authenticate him</li>
<li>The <code>SignInUtils</code> class is very handy to handle this scenario. Its constructor
optionally takes a <code>SessionStrategy</code> that will be used to retrieve the connection info.
You can customize the strategy here.</li>
</ul>
<p>A this point, your authentication process should work.
It will use the HTTP Session to store connection data and an in-memory user
repository.</p>
<h2 id=the-client>The client</h2>
<p>We can create a very simple client with any web framework.
It will need to:</p>
<ul>
<li>Issue a <code>GET /api/session</code> request to check if the user is logged</li>
<li>Display a login form that will <code>POST</code> to <code>/login/twitter</code> if not</li>
<li>Display a logout button if the user is connected. The logout button will
send a <code>DELETE /api/session</code> request.</li>
</ul>
<p>I chose to use React because of its very simple and declarative API.</p>
<p>We can use ES2015 features and JSX without a pre-compilation step thanks to
<a href=http://www.jimsproch.com/react/>this script</a>.</p>
<p>It is a bit slower because it lets the browser do the compilation but it&rsquo;s
perfect for prototyping.</p>
<p>Here is the client code:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>LoginForm</span> <span style=color:#f92672>=</span> () =&gt; (
    &lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/signin/twitter&#34;</span> <span style=color:#a6e22e>method</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;post&#34;</span>&gt;
        &lt;<span style=color:#f92672>h1</span>&gt;<span style=color:#a6e22e>Please</span> <span style=color:#a6e22e>login</span>&lt;/<span style=color:#f92672>h1</span>&gt;
        &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span>&gt;<span style=color:#a6e22e>Login</span>&lt;/<span style=color:#f92672>button</span>&gt;
    &lt;/<span style=color:#f92672>form</span>&gt;
);

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>LogoutComponent</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>props</span>) =&gt; (
    &lt;<span style=color:#f92672>div</span>&gt;
        &lt;<span style=color:#f92672>h2</span>&gt;<span style=color:#a6e22e>Your</span> <span style=color:#a6e22e>name</span> <span style=color:#a6e22e>is</span> {<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>name</span>}&lt;/<span style=color:#f92672>h2</span>&gt;
        &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>logout</span>}&gt;<span style=color:#a6e22e>Logout</span>&lt;/<span style=color:#f92672>button</span>&gt;
    &lt;/<span style=color:#f92672>div</span>&gt;
);

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Main</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>React</span>.<span style=color:#a6e22e>Component</span> {

    <span style=color:#a6e22e>constructor</span>(...<span style=color:#a6e22e>args</span>) {
        <span style=color:#66d9ef>super</span>(...<span style=color:#a6e22e>args</span>);
        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>};
    }

    <span style=color:#a6e22e>componentDidMount</span>() {
        <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;/api/session&#39;</span>, {<span style=color:#a6e22e>credentials</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;same-origin&#39;</span>})
            .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>res</span> =&gt; <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>json</span>())
            .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>session</span> =&gt; <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setState</span>({<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>session</span>.<span style=color:#a6e22e>name</span>}));
    }

    <span style=color:#a6e22e>logout</span>() {
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;logout&#34;</span>);
        <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;/api/session&#39;</span>, {<span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;delete&#39;</span>, <span style=color:#a6e22e>credentials</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;same-origin&#39;</span>})
            .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>res</span> =&gt; <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setState</span>({<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>}));
    }

    <span style=color:#a6e22e>render</span>() {
        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>profile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>?</span>
            &lt;<span style=color:#f92672>LogoutComponent</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span>{<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>name</span>} <span style=color:#a6e22e>logout</span><span style=color:#f92672>=</span>{() =&gt; <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>logout</span>()}/&gt; <span style=color:#f92672>:</span>
            &lt;<span style=color:#f92672>LoginForm</span> /&gt;;
        <span style=color:#66d9ef>return</span> (
            &lt;<span style=color:#f92672>div</span>&gt;
                {<span style=color:#a6e22e>profile</span>}
            &lt;/<span style=color:#f92672>div</span>&gt;
        )
    }
}

<span style=color:#a6e22e>ReactDOM</span>.<span style=color:#a6e22e>render</span>(&lt;<span style=color:#f92672>Main</span> /&gt;, document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;container&#39;</span>));
</code></pre></div><p>We use the <a href=https://developers.google.com/web/updates/2015/03/introduction-to-fetch>fetch API</a> (a modern replacement for XMLHttpRequest) to make ajax
calls so the code will only work in <a href="http://caniuse.com/#feat=fetch">FF and Chrome</a>.
You can find various polyfills in the wild.</p>
<p>Notice that we need to pass <code>{credentials: 'same-origin'}</code> to the REST API calls
to make sure we send the cookies along with the requests.</p>
<h2 id=store-the-connections-in-database>Store the connections in database</h2>
<p>In most applications, we want to store the user already known in a database.</p>
<p>Spring social provides a default JDBC implementation of the <code>UsersConnectionRepository</code>.
Take a look <a href=http://docs.spring.io/spring-social/docs/current/reference/htmlsingle/#section_jdbcConnectionFactory>the documentation</a>
to know more about the table in which it will store users' connections data.</p>
<p>We can initialize the database with the script contained in Spring Social&rsquo;s jar:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Component</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DbInitializer</span> <span style=color:#66d9ef>implements</span> InitializingBean <span style=color:#f92672>{</span>

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> DataSource dataSource<span style=color:#f92672>;</span>

    <span style=color:#a6e22e>@Autowired</span>
    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>DbInitializer</span><span style=color:#f92672>(</span>DataSource dataSource<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>dataSource</span> <span style=color:#f92672>=</span> dataSource<span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>afterPropertiesSet</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
        ClassPathResource resource <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ClassPathResource<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;org/springframework/social/connect/jdbc/JdbcUsersConnectionRepository.sql&#34;</span><span style=color:#f92672>);</span>
        runScript<span style=color:#f92672>(</span>resource<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>runScript</span><span style=color:#f92672>(</span>Resource resource<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        ResourceDatabasePopulator populator <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ResourceDatabasePopulator<span style=color:#f92672>();</span>
        populator<span style=color:#f92672>.</span><span style=color:#a6e22e>setContinueOnError</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
        populator<span style=color:#f92672>.</span><span style=color:#a6e22e>addScript</span><span style=color:#f92672>(</span>resource<span style=color:#f92672>);</span>
        DatabasePopulatorUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(</span>populator<span style=color:#f92672>,</span> dataSource<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Now, we need to create a <code>SocialAdapater</code> that will use Spring Social&rsquo;s
<code>JdbcUsersConnectionRepository</code> as a user repository:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DatabaseSocialConfigurer</span> <span style=color:#66d9ef>extends</span> SocialConfigurerAdapter <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> DataSource dataSource<span style=color:#f92672>;</span>

    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>DatabaseSocialConfigurer</span><span style=color:#f92672>(</span>DataSource dataSource<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>dataSource</span> <span style=color:#f92672>=</span> dataSource<span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> UsersConnectionRepository <span style=color:#a6e22e>getUsersConnectionRepository</span><span style=color:#f92672>(</span>ConnectionFactoryLocator connectionFactoryLocator<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        TextEncryptor textEncryptor <span style=color:#f92672>=</span> Encryptors<span style=color:#f92672>.</span><span style=color:#a6e22e>noOpText</span><span style=color:#f92672>();</span>
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> JdbcUsersConnectionRepository<span style=color:#f92672>(</span>dataSource<span style=color:#f92672>,</span> connectionFactoryLocator<span style=color:#f92672>,</span> textEncryptor<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Don&rsquo;t forget to declare our <code>DatabaseSocialConfigurer</code> as a Spring bean and we are
good to go!</p>
<p>Please note that this works because of an &ldquo;interesting&rdquo; design decision of
Spring Social.
You can see <a href=https://github.com/spring-projects/spring-social/blob/master/spring-social-config/src/main/java/org/springframework/social/config/annotation/SocialConfiguration.java#L87>here</a>
that Spring Social will take the first <code>SocialConfigurer</code> that declares a non-null
<code>UsersConnectionRepository</code>.</p>
<p>Ours come before the <code>SocialConfigurer</code>s auto-configured by Spring Boot but
if you are wary of this implementation, consider disabling Spring boot auto-configuration.</p>
<p>We can use the h2 console Spring boot auto-configured for us to check the database.</p>
<p><img src=/assets/images/articles/2016-02-social-db.png alt="The data in our database" title="The data in our database"></p>
<h2 id=conclusion>Conclusion</h2>
<p>Social login with Spring is a bit tricky but definitely worth the investment!</p>
<p>Spring Boot provides default configuration for LinkedIn and Facebook as well
but there are <a href=http://projects.spring.io/spring-social/>many more connectors</a> like Github and Tripit that you can include by replicating Spring Boot&rsquo;s configuration.</p>
<p>Don&rsquo;t forget to <a href=https://github.com/geowarin/boot-social-api>check out the code</a>
and give your opinion in the comments.</p>
</div>
<footer class=entry-footer>
<div class="container sep-before">
If you liked this article, please share! ❤️
<div class=article-share-links>
<a data-provider=twitter href="https://twitter.com/intent/tweet?url=https%3a%2f%2fgeowarin.github.io%2fsocial-login-with-spring%2f&via=geowarin&text=Social%20login%20with%20Spring" class="article-share twitter" target=_blank title="Share on Twitter"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg>
</a>
<a data-provider=linkedIn href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fgeowarin.github.io%2fsocial-login-with-spring%2f&title=Social%20login%20with%20Spring" class="article-share linkedin" target=_blank title="Share on LinkedIn"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
</a>
<a data-provider=facebook href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fgeowarin.github.io%2fsocial-login-with-spring%2f&t=Social%20login%20with%20Spring" class="article-share facebook" target=_blank title="Share on Facebook"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg>
</a>
<a data-provider=google href="https://plus.google.com/share?&url=https%3a%2f%2fgeowarin.github.io%2fsocial-login-with-spring%2f" class="article-share google" target=_blank title="Share on Google+"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M12 24a7 7 0 110-14 7 7 0 010 14zm0-24L0 9.5l4.838 3.94A8 8 0 0112 9a8 8 0 017.162 4.44L24 9.5z"/></svg>
</a>
<a data-provider=buffer href="https://buffer.com/add?url=https%3a%2f%2fgeowarin.github.io%2fsocial-login-with-spring%2f&text=Social%20login%20with%20Spring" class="article-share buffer" target=_blank title="Add to Buffer"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>
</a>
</div>
</div>
<div class="container sep-before">
<div class=categories><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5A2 2 0 014 3H9l2 3h9a2 2 0 012 2z"/></svg>
<span class=screen-reader-text>Categories: </span><a class=category href=/categories/spring/>spring</a></div>
<div class=tags><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2H12l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=screen-reader-text>Tags: </span><a class=tag href=/tags/spring/>spring</a>, <a class=tag href=/tags/social/>social</a>, <a class=tag href=/tags/login/>login</a></div>
</div>
</footer>
</article>
<nav class=entry-nav>
<div class=container><div class="prev-entry sep-before">
<a href=/correctly-handle-jsr-310-java-8-dates-with-jackson/>
<span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>
Previous</span>
<span class=screen-reader-text>Previous post: </span>Correctly handle JSR-310 (java 8) dates with Jackson</a>
</div><div class="next-entry sep-before">
<a href=/react-freshness/>
<span class=screen-reader-text>Next post: </span>React freshness<span aria-hidden=true>Next<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="4" y1="12" x2="20" y2="12"/><polyline points="14 6 20 12 14 18"/></svg>
</span>
</a>
</div></div>
</nav>
<section id=comments class=comments>
<div class="container sep-before">
<div class=comments-area><div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//geowarin.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
</div>
</section>
</main>
<footer id=footer class=footer>
<div class="container sep-before"><div class=copyright>
<p> &copy; 2017-2021 geowarin </p>
</div>
</div>
</footer>
</div>
</div><script>window.__assets_js_src="/assets/js/"</script>
<script src=/assets/js/main.c3bcf2df.js></script>
</body>
</html>