<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Social login with Spring | Geowarin</title>
<meta name=keywords content="spring,social,login">
<meta name=description content="Log-in with your social account in your Spring application">
<meta name=author content>
<link rel=canonical href=https://geowarin.com/social-login-with-spring/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.6f60056d44d3f7eb69a4bc6c332b59960f3a995802bded244750232f33713c49.css integrity="sha256-b2AFbUTT9+tppLxsMytZlg86mVgCve0kR1AjLzNxPEk=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://geowarin.com/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://geowarin.com/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://geowarin.com/favicon-32x32.png>
<link rel=apple-touch-icon href=https://geowarin.com/apple-touch-icon.png>
<link rel=mask-icon href=https://geowarin.com/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.89.2">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:title" content="Social login with Spring">
<meta property="og:description" content="Log-in with your social account in your Spring application">
<meta property="og:type" content="article">
<meta property="og:url" content="https://geowarin.com/social-login-with-spring/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2016-02-12T00:00:00+00:00">
<meta property="article:modified_time" content="2016-02-12T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Social login with Spring">
<meta name=twitter:description content="Log-in with your social account in your Spring application">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://geowarin.com/post/"},{"@type":"ListItem","position":3,"name":"Social login with Spring","item":"https://geowarin.com/social-login-with-spring/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Social login with Spring","name":"Social login with Spring","description":"Log-in with your social account in your Spring application","keywords":["spring","social","login"],"articleBody":"Nowadays, it’s getting rare and even a bit annoying when a service rolls up its own authentication mechanism instead of relying on a OAuth sign-on with our social networks.\nLogin via social networks means fewer passwords to remember, and stronger guarantees in terms of security because you can check and control the authorizations of the applications you use.\nIn this article, I will show you how to allow users to log into your application via Twitter from a rich Javascript client (React).\nWe will also persist our users connections in database.\nThe code is available on github.\nSetting up your app on Twitter Before coding anything, you will need to create a new Twitter application in your twitter apps page.\nThen go to the “Keys and access tokens” tab and note your API key and API secret ids.\nCreating a Spring Boot app Use the Spring initializer to create a new Spring Boot application. You will need the following dependencies:\ndependencies { compile('org.springframework.boot:spring-boot-devtools') compile('org.springframework.boot:spring-boot-starter-security') compile('org.springframework.boot:spring-boot-starter-social-twitter') compile('org.springframework.boot:spring-boot-starter-web') compile('org.springframework.boot:spring-boot-starter-jdbc') compile('com.h2database:h2') } Please copy your appId and appSecret in the application.properties file and configure a few things:\nspring.social.twitter.appId=  spring.social.twitter.appSecret=  # Disable auto views, we are making an API spring.social.auto-connection-views=false # Disable basic security security.basic.enabled=false # Persist H2 data to disk to keep connection info between reboots spring.datasource.url=jdbc:h2:~/social-test Sign-in and Sign-up flows Spring social has two different flows when someone logs into your app via social networks.\nThe first time someone logs into your application, they will go through the sign-up flow. If their ID already registered in Spring Social, they will go through the sign-in flow instead.\nYou job is to create a SignInAdapter that will handle the sign-in process and a controller that will decide what to do during the sign-up process (you will receive a request on the /signup URL by default).\nHere is an overview of the authentication flow in Spring Social:\n Your application produces a POST request to /signin/{providerId} The ProviderSigninController then redirects the user to the identification provider’s sign-in screen The user logs in The identification provider will send the OAuth token with GET request to /signin/{providerId} If the user is not found in the UsersConnectionRepository, the controller will use a SessionStrategy to store the pending login request and will then redirect to the signupUrl page If the user is found, your SignInAdapter interface is called  If you want to know more details about Spring social inner workings, check the SocialWebAutoConfiguration class of Spring Boot and the ProviderSignInController class of Spring Social.\nIn the above diagram, we can see that we have two more extensions points:\n The SessionStrategy. By default, it stores temporary information about the connection in the HTTP session The UsersConnectionRepository. By default, Spring boot provides an InMemoryUsersConnectionRepository. Connections will be lost when your application reboots.  Spring Security Config We need to enable security in our application. Let’s create a classic security configuration. It will make sure that users using our REST api are authenticated but will let calls to /api/session, our authentication end point, go through:\n@Configuration @Order(SecurityProperties.ACCESS_OVERRIDE_ORDER) public class SecurityConfiguration extends WebSecurityConfigurerAdapter { @Override protected void configure(HttpSecurity http) throws Exception { http .authorizeRequests() .antMatchers(\"/api/session\").permitAll() .antMatchers(\"/h2-console/**\").permitAll() .antMatchers(\"/api/**\").authenticated() .and() .headers().frameOptions().disable() // for h2  .and() .requestCache() .requestCache(new NullRequestCache()) .and() .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED) .and().csrf().disable(); } } The authentication end point is very simple. It provides a way to GET the current session and to DELETE it to logout:\n@RestController @RequestMapping(\"/api/session\") public class AuthenticationResource { @Autowired AuthenticationManager authenticationManager; @RequestMapping(method = RequestMethod.GET) public User session(Principal user) { String name = user == null ? null : user.getName(); return new User(name); } @RequestMapping(method = RequestMethod.DELETE) public void logout(HttpSession session) { session.invalidate(); } } Sign-in To handle the sign-in, we need to provide a SignInAdapter:\n@Configuration public class SocialConfiguration { @Bean public SignInAdapter authSignInAdapter() { return (userId, connection, request) - { AuthUtil.authenticate(connection); return null; }; } } We can create a simple authenticate method that will take a Social Connection and authenticate the user using Spring Security’s context:\npublic class AuthUtil { protected static final Logger log = LoggerFactory.getLogger(AuthUtil.class); public static void authenticate(Connection connection) { UserProfile userProfile = connection.fetchUserProfile(); String username = userProfile.getUsername(); UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(username, null, null); SecurityContextHolder.getContext().setAuthentication(authentication); log.info(\"User {} {} connected.\", userProfile.getFirstName(), userProfile.getLastName()); } } Note that we have access to our user’s profile with the Connection object.\nSign-up Here is a simple implementation of a signup controller:\n@Controller public class SignupController { private final ProviderSignInUtils signInUtils; @Autowired public SignupController(ConnectionFactoryLocator connectionFactoryLocator, UsersConnectionRepository connectionRepository) { signInUtils = new ProviderSignInUtils(connectionFactoryLocator, connectionRepository); } @RequestMapping(value = \"/signup\") public String signup(WebRequest request) { Connection connection = signInUtils.getConnectionFromSession(request); if (connection != null) { AuthUtil.authenticate(connection); signInUtils.doPostSignUp(connection.getDisplayName(), request); } return \"redirect:/\"; } } There are two things to note here:\n Spring lets us decide what to do the first time we register a user. In this example, we just authenticate him The SignInUtils class is very handy to handle this scenario. Its constructor optionally takes a SessionStrategy that will be used to retrieve the connection info. You can customize the strategy here.  A this point, your authentication process should work. It will use the HTTP Session to store connection data and an in-memory user repository.\nThe client We can create a very simple client with any web framework. It will need to:\n Issue a GET /api/session request to check if the user is logged Display a login form that will POST to /login/twitter if not Display a logout button if the user is connected. The logout button will send a DELETE /api/session request.  I chose to use React because of its very simple and declarative API.\nWe can use ES2015 features and JSX without a pre-compilation step thanks to this script.\nIt is a bit slower because it lets the browser do the compilation but it’s perfect for prototyping.\nHere is the client code:\nconst LoginForm = () = ( form action=\"/signin/twitter\" method=\"post\" h1Please loginh1 button type=\"submit\"Loginbutton form ); const LogoutComponent = (props) = ( div h2Your name is {props.name}h2 button onClick={props.logout}Logoutbutton div ); class Main extends React.Component { constructor(...args) { super(...args); this.state = {name: null}; } componentDidMount() { fetch('/api/session', {credentials: 'same-origin'}) .then(res = res.json()) .then(session = this.setState({name: session.name})); } logout() { console.log(\"logout\"); fetch('/api/session', {method: 'delete', credentials: 'same-origin'}) .then(res = this.setState({name: null})); } render() { const profile = this.state.name ? LogoutComponent name={this.state.name} logout={() = this.logout()}/ : LoginForm /; return ( div {profile} div ) } } ReactDOM.render(Main /, document.getElementById('container')); We use the fetch API (a modern replacement for XMLHttpRequest) to make ajax calls so the code will only work in FF and Chrome. You can find various polyfills in the wild.\nNotice that we need to pass {credentials: 'same-origin'} to the REST API calls to make sure we send the cookies along with the requests.\nStore the connections in database In most applications, we want to store the user already known in a database.\nSpring social provides a default JDBC implementation of the UsersConnectionRepository. Take a look the documentation to know more about the table in which it will store users' connections data.\nWe can initialize the database with the script contained in Spring Social’s jar:\n@Component public class DbInitializer implements InitializingBean { private final DataSource dataSource; @Autowired public DbInitializer(DataSource dataSource) { this.dataSource = dataSource; } @Override public void afterPropertiesSet() throws Exception { ClassPathResource resource = new ClassPathResource(\"org/springframework/social/connect/jdbc/JdbcUsersConnectionRepository.sql\"); runScript(resource); } private void runScript(Resource resource) { ResourceDatabasePopulator populator = new ResourceDatabasePopulator(); populator.setContinueOnError(true); populator.addScript(resource); DatabasePopulatorUtils.execute(populator, dataSource); } } Now, we need to create a SocialAdapater that will use Spring Social’s JdbcUsersConnectionRepository as a user repository:\nclass DatabaseSocialConfigurer extends SocialConfigurerAdapter { private final DataSource dataSource; public DatabaseSocialConfigurer(DataSource dataSource) { this.dataSource = dataSource; } @Override public UsersConnectionRepository getUsersConnectionRepository(ConnectionFactoryLocator connectionFactoryLocator) { TextEncryptor textEncryptor = Encryptors.noOpText(); return new JdbcUsersConnectionRepository(dataSource, connectionFactoryLocator, textEncryptor); } } Don’t forget to declare our DatabaseSocialConfigurer as a Spring bean and we are good to go!\nPlease note that this works because of an “interesting” design decision of Spring Social. You can see here that Spring Social will take the first SocialConfigurer that declares a non-null UsersConnectionRepository.\nOurs come before the SocialConfigurers auto-configured by Spring Boot but if you are wary of this implementation, consider disabling Spring boot auto-configuration.\nWe can use the h2 console Spring boot auto-configured for us to check the database.\nConclusion Social login with Spring is a bit tricky but definitely worth the investment!\nSpring Boot provides default configuration for LinkedIn and Facebook as well but there are many more connectors like Github and Tripit that you can include by replicating Spring Boot’s configuration.\nDon’t forget to check out the code and give your opinion in the comments.\n","wordCount":"1415","inLanguage":"en","datePublished":"2016-02-12T00:00:00Z","dateModified":"2016-02-12T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://geowarin.com/social-login-with-spring/"},"publisher":{"@type":"Organization","name":"Geowarin","logo":{"@type":"ImageObject","url":"https://geowarin.com/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://geowarin.com accesskey=h title="Geowarin (Alt + H)">Geowarin</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://geowarin.com/archive/ title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://geowarin.com/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
<li>
<a href=https://geowarin.com/mastering-spring-mvc-4/ title=Book>
<span>Book</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://geowarin.com>Home</a>&nbsp;»&nbsp;<a href=https://geowarin.com/post/>Posts</a></div>
<h1 class=post-title>
Social login with Spring
</h1>
<div class=post-meta><span title="2016-02-12 00:00:00 +0000 UTC">February 12, 2016</span>&nbsp;·&nbsp;7 min
</div>
</header>
<div class=post-content><p>Nowadays, it&rsquo;s getting rare and even a bit annoying when a service rolls up its own
authentication mechanism instead of relying on a OAuth sign-on with our social
networks.</p>
<p>Login via social networks means fewer passwords to remember, and stronger guarantees
in terms of security because you can check and control the authorizations of the applications
you use.</p>
<p>In this article, I will show you how to allow users to log into your application
via Twitter from a rich Javascript client (React).</p>
<p>We will also persist our users connections in database.</p>
<p>The code is available <a href=https://github.com/geowarin/boot-social-api>on github</a>.</p>
<h2 id=setting-up-your-app-on-twitter>Setting up your app on Twitter<a hidden class=anchor aria-hidden=true href=#setting-up-your-app-on-twitter>#</a></h2>
<p>Before coding anything, you will need to create a new Twitter application
in <a href=https://apps.twitter.com/>your twitter apps page</a>.</p>
<p><img loading=lazy src=/assets/images/articles/2016-02-twitter-app.png alt="Creating a Twitter app" title="Creating a Twitter app">
</p>
<p>Then go to the &ldquo;Keys and access tokens&rdquo; tab and note your API key and API secret
ids.</p>
<p><img loading=lazy src=/assets/images/articles/2016-02-twitter-app-keys.png alt="Twitter app keys" title="Twitter app keys">
</p>
<h2 id=creating-a-spring-boot-app>Creating a Spring Boot app<a hidden class=anchor aria-hidden=true href=#creating-a-spring-boot-app>#</a></h2>
<p>Use the <a href=http://start.spring.io>Spring initializer</a> to create a new Spring Boot
application. You will need the following dependencies:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>dependencies <span style=color:#f92672>{</span>
	compile<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-devtools&#39;</span><span style=color:#f92672>)</span>
	compile<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-security&#39;</span><span style=color:#f92672>)</span>
	compile<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-social-twitter&#39;</span><span style=color:#f92672>)</span>
	compile<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-web&#39;</span><span style=color:#f92672>)</span>
	compile<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-jdbc&#39;</span><span style=color:#f92672>)</span>
	compile<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;com.h2database:h2&#39;</span><span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Please copy your <code>appId</code> and <code>appSecret</code> in the <code>application.properties</code> file and
configure a few things:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#a6e22e>spring.social.twitter.appId</span><span style=color:#f92672>=</span> <span style=color:#e6db74>&lt;Consumer Key&gt;</span>
<span style=color:#a6e22e>spring.social.twitter.appSecret</span><span style=color:#f92672>=</span> <span style=color:#e6db74>&lt;Consumer Secret&gt;</span>
<span style=color:#75715e># Disable auto views, we are making an API</span>
<span style=color:#a6e22e>spring.social.auto-connection-views</span><span style=color:#f92672>=</span><span style=color:#e6db74>false</span>
<span style=color:#75715e># Disable basic security</span>
<span style=color:#a6e22e>security.basic.enabled</span><span style=color:#f92672>=</span><span style=color:#e6db74>false</span>
<span style=color:#75715e># Persist H2 data to disk to keep connection info between reboots</span>
<span style=color:#a6e22e>spring.datasource.url</span><span style=color:#f92672>=</span><span style=color:#e6db74>jdbc:h2:~/social-test</span>
</code></pre></div><h2 id=sign-in-and-sign-up-flows>Sign-in and Sign-up flows<a hidden class=anchor aria-hidden=true href=#sign-in-and-sign-up-flows>#</a></h2>
<p>Spring social has two different flows when someone logs into your app via social
networks.</p>
<p>The first time someone logs into your application, they will go through the sign-up flow.
If their ID already registered in Spring Social, they will go through the sign-in
flow instead.</p>
<p>You job is to create a <code>SignInAdapter</code> that will handle the sign-in process and
a controller that will decide what to do during the sign-up process (you will receive a
request on the <code>/signup</code> URL by default).</p>
<p>Here is an overview of the authentication flow in Spring Social:</p>
<p><img loading=lazy src=/assets/images/articles/2016-02-social-flow.png alt="Spring Social flow" title="Spring Social flow">
</p>
<ul>
<li>Your application produces a POST request to <code>/signin/{providerId}</code></li>
<li>The <code>ProviderSigninController</code> then redirects the user to the identification provider&rsquo;s sign-in screen</li>
<li>The user logs in</li>
<li>The identification provider will send the OAuth token with GET request to <code>/signin/{providerId}</code></li>
<li>If the user is not found in the <code>UsersConnectionRepository</code>, the controller will use a <code>SessionStrategy</code> to store the pending login request and will then redirect to the signupUrl page</li>
<li>If the user is found, your <code>SignInAdapter</code> interface is called</li>
</ul>
<p>If you want to know more details about Spring social inner workings, check the <code>SocialWebAutoConfiguration</code> class of Spring Boot and the <code>ProviderSignInController</code> class
of Spring Social.</p>
<p>In the above diagram, we can see that we have two more extensions points:</p>
<ul>
<li>The <code>SessionStrategy</code>. By default, it stores temporary information about the connection
in the HTTP session</li>
<li>The <code>UsersConnectionRepository</code>. By default, Spring boot provides an <code>InMemoryUsersConnectionRepository</code>. Connections will be lost when your application
reboots.</li>
</ul>
<h2 id=spring-security-config>Spring Security Config<a hidden class=anchor aria-hidden=true href=#spring-security-config>#</a></h2>
<p>We need to enable security in our application. Let&rsquo;s create a classic security
configuration.
It will make sure that users using our REST api are authenticated but will let calls
to <code>/api/session</code>, our authentication end point, go through:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Configuration</span>
<span style=color:#a6e22e>@Order</span><span style=color:#f92672>(</span>SecurityProperties<span style=color:#f92672>.</span><span style=color:#a6e22e>ACCESS_OVERRIDE_ORDER</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecurityConfiguration</span> <span style=color:#66d9ef>extends</span> WebSecurityConfigurerAdapter <span style=color:#f92672>{</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>(</span>HttpSecurity http<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
        http
                <span style=color:#f92672>.</span><span style=color:#a6e22e>authorizeRequests</span><span style=color:#f92672>()</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>antMatchers</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/api/session&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>permitAll</span><span style=color:#f92672>()</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>antMatchers</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/h2-console/**&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>permitAll</span><span style=color:#f92672>()</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>antMatchers</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/api/**&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>authenticated</span><span style=color:#f92672>()</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>and</span><span style=color:#f92672>()</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>headers</span><span style=color:#f92672>().</span><span style=color:#a6e22e>frameOptions</span><span style=color:#f92672>().</span><span style=color:#a6e22e>disable</span><span style=color:#f92672>()</span> <span style=color:#75715e>// for h2
</span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>and</span><span style=color:#f92672>()</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>requestCache</span><span style=color:#f92672>()</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>requestCache</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> NullRequestCache<span style=color:#f92672>())</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>and</span><span style=color:#f92672>()</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>sessionManagement</span><span style=color:#f92672>().</span><span style=color:#a6e22e>sessionCreationPolicy</span><span style=color:#f92672>(</span>SessionCreationPolicy<span style=color:#f92672>.</span><span style=color:#a6e22e>IF_REQUIRED</span><span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>and</span><span style=color:#f92672>().</span><span style=color:#a6e22e>csrf</span><span style=color:#f92672>().</span><span style=color:#a6e22e>disable</span><span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>The authentication end point is very simple. It provides a way to <code>GET</code> the
current session and to <code>DELETE</code> it to logout:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@RestController</span>
<span style=color:#a6e22e>@RequestMapping</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/api/session&#34;</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AuthenticationResource</span> <span style=color:#f92672>{</span>
    <span style=color:#a6e22e>@Autowired</span>
    AuthenticationManager authenticationManager<span style=color:#f92672>;</span>

    <span style=color:#a6e22e>@RequestMapping</span><span style=color:#f92672>(</span>method <span style=color:#f92672>=</span> RequestMethod<span style=color:#f92672>.</span><span style=color:#a6e22e>GET</span><span style=color:#f92672>)</span>
    <span style=color:#66d9ef>public</span> User <span style=color:#a6e22e>session</span><span style=color:#f92672>(</span>Principal user<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        String name <span style=color:#f92672>=</span> user <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>:</span> user<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>();</span>
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> User<span style=color:#f92672>(</span>name<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@RequestMapping</span><span style=color:#f92672>(</span>method <span style=color:#f92672>=</span> RequestMethod<span style=color:#f92672>.</span><span style=color:#a6e22e>DELETE</span><span style=color:#f92672>)</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>logout</span><span style=color:#f92672>(</span>HttpSession session<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        session<span style=color:#f92672>.</span><span style=color:#a6e22e>invalidate</span><span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><h2 id=sign-in>Sign-in<a hidden class=anchor aria-hidden=true href=#sign-in>#</a></h2>
<p>To handle the sign-in, we need to provide a <code>SignInAdapter</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Configuration</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SocialConfiguration</span> <span style=color:#f92672>{</span>

    <span style=color:#a6e22e>@Bean</span>
    <span style=color:#66d9ef>public</span> SignInAdapter <span style=color:#a6e22e>authSignInAdapter</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>userId<span style=color:#f92672>,</span> connection<span style=color:#f92672>,</span> request<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
            AuthUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>authenticate</span><span style=color:#f92672>(</span>connection<span style=color:#f92672>);</span>
            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
        <span style=color:#f92672>};</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>We can create a simple <code>authenticate</code> method that will take a Social <code>Connection</code>
and authenticate the user using Spring Security&rsquo;s context:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AuthUtil</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> Logger log <span style=color:#f92672>=</span> LoggerFactory<span style=color:#f92672>.</span><span style=color:#a6e22e>getLogger</span><span style=color:#f92672>(</span>AuthUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>authenticate</span><span style=color:#f92672>(</span>Connection<span style=color:#f92672>&lt;?&gt;</span> connection<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        UserProfile userProfile <span style=color:#f92672>=</span> connection<span style=color:#f92672>.</span><span style=color:#a6e22e>fetchUserProfile</span><span style=color:#f92672>();</span>
        String username <span style=color:#f92672>=</span> userProfile<span style=color:#f92672>.</span><span style=color:#a6e22e>getUsername</span><span style=color:#f92672>();</span>
        UsernamePasswordAuthenticationToken authentication <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> UsernamePasswordAuthenticationToken<span style=color:#f92672>(</span>username<span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
        SecurityContextHolder<span style=color:#f92672>.</span><span style=color:#a6e22e>getContext</span><span style=color:#f92672>().</span><span style=color:#a6e22e>setAuthentication</span><span style=color:#f92672>(</span>authentication<span style=color:#f92672>);</span>
        log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;User {} {} connected.&#34;</span><span style=color:#f92672>,</span> userProfile<span style=color:#f92672>.</span><span style=color:#a6e22e>getFirstName</span><span style=color:#f92672>(),</span> userProfile<span style=color:#f92672>.</span><span style=color:#a6e22e>getLastName</span><span style=color:#f92672>());</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Note that we have access to our user&rsquo;s profile with the <code>Connection</code>
object.</p>
<h2 id=sign-up>Sign-up<a hidden class=anchor aria-hidden=true href=#sign-up>#</a></h2>
<p>Here is a simple implementation of a signup controller:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Controller</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SignupController</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> ProviderSignInUtils signInUtils<span style=color:#f92672>;</span>

    <span style=color:#a6e22e>@Autowired</span>
    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>SignupController</span><span style=color:#f92672>(</span>ConnectionFactoryLocator connectionFactoryLocator<span style=color:#f92672>,</span> UsersConnectionRepository connectionRepository<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        signInUtils <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ProviderSignInUtils<span style=color:#f92672>(</span>connectionFactoryLocator<span style=color:#f92672>,</span> connectionRepository<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@RequestMapping</span><span style=color:#f92672>(</span>value <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/signup&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>signup</span><span style=color:#f92672>(</span>WebRequest request<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        Connection<span style=color:#f92672>&lt;?&gt;</span> connection <span style=color:#f92672>=</span> signInUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>getConnectionFromSession</span><span style=color:#f92672>(</span>request<span style=color:#f92672>);</span>
        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>connection <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
            AuthUtil<span style=color:#f92672>.</span><span style=color:#a6e22e>authenticate</span><span style=color:#f92672>(</span>connection<span style=color:#f92672>);</span>
            signInUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>doPostSignUp</span><span style=color:#f92672>(</span>connection<span style=color:#f92672>.</span><span style=color:#a6e22e>getDisplayName</span><span style=color:#f92672>(),</span> request<span style=color:#f92672>);</span>
        <span style=color:#f92672>}</span>
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;redirect:/&#34;</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>There are two things to note here:</p>
<ul>
<li>Spring lets us decide what to do the first time we register a user. In this
example, we just authenticate him</li>
<li>The <code>SignInUtils</code> class is very handy to handle this scenario. Its constructor
optionally takes a <code>SessionStrategy</code> that will be used to retrieve the connection info.
You can customize the strategy here.</li>
</ul>
<p>A this point, your authentication process should work.
It will use the HTTP Session to store connection data and an in-memory user
repository.</p>
<h2 id=the-client>The client<a hidden class=anchor aria-hidden=true href=#the-client>#</a></h2>
<p>We can create a very simple client with any web framework.
It will need to:</p>
<ul>
<li>Issue a <code>GET /api/session</code> request to check if the user is logged</li>
<li>Display a login form that will <code>POST</code> to <code>/login/twitter</code> if not</li>
<li>Display a logout button if the user is connected. The logout button will
send a <code>DELETE /api/session</code> request.</li>
</ul>
<p>I chose to use React because of its very simple and declarative API.</p>
<p>We can use ES2015 features and JSX without a pre-compilation step thanks to
<a href=http://www.jimsproch.com/react/>this script</a>.</p>
<p>It is a bit slower because it lets the browser do the compilation but it&rsquo;s
perfect for prototyping.</p>
<p>Here is the client code:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>LoginForm</span> <span style=color:#f92672>=</span> () =&gt; (
    &lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/signin/twitter&#34;</span> <span style=color:#a6e22e>method</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;post&#34;</span>&gt;
        &lt;<span style=color:#f92672>h1</span>&gt;<span style=color:#a6e22e>Please</span> <span style=color:#a6e22e>login</span>&lt;/<span style=color:#f92672>h1</span>&gt;
        &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span>&gt;<span style=color:#a6e22e>Login</span>&lt;/<span style=color:#f92672>button</span>&gt;
    &lt;/<span style=color:#f92672>form</span>&gt;
);

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>LogoutComponent</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>props</span>) =&gt; (
    &lt;<span style=color:#f92672>div</span>&gt;
        &lt;<span style=color:#f92672>h2</span>&gt;<span style=color:#a6e22e>Your</span> <span style=color:#a6e22e>name</span> <span style=color:#a6e22e>is</span> {<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>name</span>}&lt;/<span style=color:#f92672>h2</span>&gt;
        &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>logout</span>}&gt;<span style=color:#a6e22e>Logout</span>&lt;/<span style=color:#f92672>button</span>&gt;
    &lt;/<span style=color:#f92672>div</span>&gt;
);

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Main</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>React</span>.<span style=color:#a6e22e>Component</span> {

    <span style=color:#a6e22e>constructor</span>(...<span style=color:#a6e22e>args</span>) {
        <span style=color:#66d9ef>super</span>(...<span style=color:#a6e22e>args</span>);
        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> {<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>};
    }

    <span style=color:#a6e22e>componentDidMount</span>() {
        <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;/api/session&#39;</span>, {<span style=color:#a6e22e>credentials</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;same-origin&#39;</span>})
            .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>res</span> =&gt; <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>json</span>())
            .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>session</span> =&gt; <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setState</span>({<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>session</span>.<span style=color:#a6e22e>name</span>}));
    }

    <span style=color:#a6e22e>logout</span>() {
        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;logout&#34;</span>);
        <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;/api/session&#39;</span>, {<span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;delete&#39;</span>, <span style=color:#a6e22e>credentials</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;same-origin&#39;</span>})
            .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>res</span> =&gt; <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setState</span>({<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>}));
    }

    <span style=color:#a6e22e>render</span>() {
        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>profile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>?</span>
            &lt;<span style=color:#f92672>LogoutComponent</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span>{<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>name</span>} <span style=color:#a6e22e>logout</span><span style=color:#f92672>=</span>{() =&gt; <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>logout</span>()}/&gt; <span style=color:#f92672>:</span>
            &lt;<span style=color:#f92672>LoginForm</span> /&gt;;
        <span style=color:#66d9ef>return</span> (
            &lt;<span style=color:#f92672>div</span>&gt;
                {<span style=color:#a6e22e>profile</span>}
            &lt;/<span style=color:#f92672>div</span>&gt;
        )
    }
}

<span style=color:#a6e22e>ReactDOM</span>.<span style=color:#a6e22e>render</span>(&lt;<span style=color:#f92672>Main</span> /&gt;, document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;container&#39;</span>));
</code></pre></div><p>We use the <a href=https://developers.google.com/web/updates/2015/03/introduction-to-fetch>fetch API</a> (a modern replacement for XMLHttpRequest) to make ajax
calls so the code will only work in <a href="http://caniuse.com/#feat=fetch">FF and Chrome</a>.
You can find various polyfills in the wild.</p>
<p>Notice that we need to pass <code>{credentials: 'same-origin'}</code> to the REST API calls
to make sure we send the cookies along with the requests.</p>
<h2 id=store-the-connections-in-database>Store the connections in database<a hidden class=anchor aria-hidden=true href=#store-the-connections-in-database>#</a></h2>
<p>In most applications, we want to store the user already known in a database.</p>
<p>Spring social provides a default JDBC implementation of the <code>UsersConnectionRepository</code>.
Take a look <a href=http://docs.spring.io/spring-social/docs/current/reference/htmlsingle/#section_jdbcConnectionFactory>the documentation</a>
to know more about the table in which it will store users' connections data.</p>
<p>We can initialize the database with the script contained in Spring Social&rsquo;s jar:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Component</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DbInitializer</span> <span style=color:#66d9ef>implements</span> InitializingBean <span style=color:#f92672>{</span>

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> DataSource dataSource<span style=color:#f92672>;</span>

    <span style=color:#a6e22e>@Autowired</span>
    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>DbInitializer</span><span style=color:#f92672>(</span>DataSource dataSource<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>dataSource</span> <span style=color:#f92672>=</span> dataSource<span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>afterPropertiesSet</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
        ClassPathResource resource <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ClassPathResource<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;org/springframework/social/connect/jdbc/JdbcUsersConnectionRepository.sql&#34;</span><span style=color:#f92672>);</span>
        runScript<span style=color:#f92672>(</span>resource<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>runScript</span><span style=color:#f92672>(</span>Resource resource<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        ResourceDatabasePopulator populator <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ResourceDatabasePopulator<span style=color:#f92672>();</span>
        populator<span style=color:#f92672>.</span><span style=color:#a6e22e>setContinueOnError</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
        populator<span style=color:#f92672>.</span><span style=color:#a6e22e>addScript</span><span style=color:#f92672>(</span>resource<span style=color:#f92672>);</span>
        DatabasePopulatorUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>execute</span><span style=color:#f92672>(</span>populator<span style=color:#f92672>,</span> dataSource<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Now, we need to create a <code>SocialAdapater</code> that will use Spring Social&rsquo;s
<code>JdbcUsersConnectionRepository</code> as a user repository:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DatabaseSocialConfigurer</span> <span style=color:#66d9ef>extends</span> SocialConfigurerAdapter <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> DataSource dataSource<span style=color:#f92672>;</span>

    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>DatabaseSocialConfigurer</span><span style=color:#f92672>(</span>DataSource dataSource<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>dataSource</span> <span style=color:#f92672>=</span> dataSource<span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> UsersConnectionRepository <span style=color:#a6e22e>getUsersConnectionRepository</span><span style=color:#f92672>(</span>ConnectionFactoryLocator connectionFactoryLocator<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        TextEncryptor textEncryptor <span style=color:#f92672>=</span> Encryptors<span style=color:#f92672>.</span><span style=color:#a6e22e>noOpText</span><span style=color:#f92672>();</span>
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> JdbcUsersConnectionRepository<span style=color:#f92672>(</span>dataSource<span style=color:#f92672>,</span> connectionFactoryLocator<span style=color:#f92672>,</span> textEncryptor<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Don&rsquo;t forget to declare our <code>DatabaseSocialConfigurer</code> as a Spring bean and we are
good to go!</p>
<p>Please note that this works because of an &ldquo;interesting&rdquo; design decision of
Spring Social.
You can see <a href=https://github.com/spring-projects/spring-social/blob/master/spring-social-config/src/main/java/org/springframework/social/config/annotation/SocialConfiguration.java#L87>here</a>
that Spring Social will take the first <code>SocialConfigurer</code> that declares a non-null
<code>UsersConnectionRepository</code>.</p>
<p>Ours come before the <code>SocialConfigurer</code>s auto-configured by Spring Boot but
if you are wary of this implementation, consider disabling Spring boot auto-configuration.</p>
<p>We can use the h2 console Spring boot auto-configured for us to check the database.</p>
<p><img loading=lazy src=/assets/images/articles/2016-02-social-db.png alt="The data in our database" title="The data in our database">
</p>
<h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2>
<p>Social login with Spring is a bit tricky but definitely worth the investment!</p>
<p>Spring Boot provides default configuration for LinkedIn and Facebook as well
but there are <a href=http://projects.spring.io/spring-social/>many more connectors</a> like Github and Tripit that you can include by replicating Spring Boot&rsquo;s configuration.</p>
<p>Don&rsquo;t forget to <a href=https://github.com/geowarin/boot-social-api>check out the code</a>
and give your opinion in the comments.</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://geowarin.com/tags/spring/>spring</a></li>
<li><a href=https://geowarin.com/tags/social/>social</a></li>
<li><a href=https://geowarin.com/tags/login/>login</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://geowarin.com/react-freshness/>
<span class=title>« Prev Page</span>
<br>
<span>React freshness</span>
</a>
<a class=next href=https://geowarin.com/correctly-handle-jsr-310-java-8-dates-with-jackson/>
<span class=title>Next Page »</span>
<br>
<span>Correctly handle JSR-310 (java 8) dates with Jackson</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Social login with Spring on twitter" href="https://twitter.com/intent/tweet/?text=Social%20login%20with%20Spring&url=https%3a%2f%2fgeowarin.com%2fsocial-login-with-spring%2f&hashtags=spring%2csocial%2clogin"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Social login with Spring on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fgeowarin.com%2fsocial-login-with-spring%2f&title=Social%20login%20with%20Spring&summary=Social%20login%20with%20Spring&source=https%3a%2f%2fgeowarin.com%2fsocial-login-with-spring%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Social login with Spring on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fgeowarin.com%2fsocial-login-with-spring%2f&title=Social%20login%20with%20Spring"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Social login with Spring on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fgeowarin.com%2fsocial-login-with-spring%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Social login with Spring on whatsapp" href="https://api.whatsapp.com/send?text=Social%20login%20with%20Spring%20-%20https%3a%2f%2fgeowarin.com%2fsocial-login-with-spring%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Social login with Spring on telegram" href="https://telegram.me/share/url?text=Social%20login%20with%20Spring&url=https%3a%2f%2fgeowarin.com%2fsocial-login-with-spring%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer><div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//geowarin.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://geowarin.com>Geowarin</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>